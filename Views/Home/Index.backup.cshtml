@{
  Layout = null;
  // TarayÄ±cÄ± file:/// yollarÄ±nÄ± engeller; uygulama iÃ§i statik kaynaÄŸÄ± kullan.
  var logoPath = Url.Content("~/img/orhan-logo.svg");
}
<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orhan KarakoÃ§ Tekstil Â· Desen Arama</title>
  <link rel="icon" href="~/img/orhan-logo.svg" type="image/svg+xml" />
  <style>
    :root {
      color-scheme: light dark;
      --bg:#0b1120;
      --panel:#111a2e;
      --panel-strong:#152243;
      --accent:#3b82f6;
      --accent-strong:#2563eb;
      --text:#f8fafc;
      --text-muted:#94a3b8;
      --border:rgba(148,163,184,.2);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', sans-serif;
      background: radial-gradient(circle at top, rgba(59,130,246,.25), transparent 45%), var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 24px;
      position: relative;
      overflow-x: hidden;
    }
    body::before,
    body::after {
      content: '';
      position: fixed;
      width: 520px;
      height: 520px;
      border-radius: 999px;
      background: radial-gradient(circle, rgba(59,130,246,.2), transparent 70%);
      filter: blur(20px);
      opacity: .8;
      pointer-events: none;
      z-index: 0;
    }
    body::before { top: -200px; right: -120px; }
    body::after { bottom: -180px; left: -120px; background: radial-gradient(circle, rgba(14,165,233,.2), transparent 70%); }
    .shell { max-width: 1400px; margin: 0 auto; display: flex; flex-direction: column; gap: 24px; position: relative; z-index: 1; }
    .badge {
      padding: 4px 14px;
      border-radius: 999px;
      font-size: .85rem;
      border: 1px solid rgba(148,163,184,.4);
    }
    .badge.ok { background: rgba(16,185,129,.15); color: #6ee7b7; border-color: rgba(16,185,129,.35); }
    .badge.warn { background: rgba(234,179,8,.15); color: #fde68a; border-color: rgba(234,179,8,.35); }
    .grid { display: grid; grid-template-columns: 280px 1fr 320px; gap: 20px; }
    .stack { display: flex; flex-direction: column; gap: 20px; }
    .panel {
      background: var(--panel);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(2,6,23,.45);
    }
    .panel-title { display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .panel h2 { margin: 0 0 12px; font-size: 1.05rem; text-transform: uppercase; letter-spacing: .08em; color: var(--text-muted); }
    .field { display: flex; flex-direction: column; gap: 6px; margin-bottom: 14px; }
    .filters { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; }
    label { font-size: .85rem; color: var(--text-muted); }
    input[type="text"], select {
      background: var(--panel-strong);
      border: 1px solid rgba(148,163,184,.25);
      color: var(--text);
      border-radius: 10px;
      padding: 10px 12px;
      font-size: .95rem;
    }
    select:disabled { opacity: .6; cursor: not-allowed; }
    .pill-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
    .pill { padding: 4px 12px; border-radius: 999px; font-size: .8rem; background: rgba(59,130,246,.15); color: #bfdbfe; border: 1px solid rgba(59,130,246,.4); cursor: default; }
    button {
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      font-size: .95rem;
      letter-spacing: .02em;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
    }
    button.primary {
      background: linear-gradient(135deg, var(--accent), var(--accent-strong));
      color: #fff;
      box-shadow: 0 10px 25px rgba(59,130,246,.35);
    }
    button.primary:disabled { opacity: .5; cursor: not-allowed; box-shadow: none; }
    button.ghost {
      background: rgba(15,23,42,.6);
      color: var(--text-muted);
      border: 1px solid rgba(148,163,184,.2);
    }
    button:hover:not(:disabled) { transform: translateY(-2px); }
    .camera-card, .preview-card, .result-card {
      background: var(--panel-strong);
      border-radius: 18px;
      border: 1px solid rgba(148,163,184,.2);
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .camera-card input[type="file"] {
      border: 2px dashed rgba(59,130,246,.4);
      padding: 28px;
      border-radius: 14px;
      text-align: center;
      cursor: pointer;
      color: var(--text-muted);
      background: rgba(30,41,59,.6);
    }
    .preview-window {
      position: relative;
      min-height: 260px;
      border-radius: 16px;
      background: #020617;
      border: 1px solid rgba(148,163,184,.25);
      overflow: hidden;
    }
    .preview-window img { width: 100%; height: 100%; object-fit: contain; display: block; }
    /* Tam ekran gÃ¶rÃ¼ntÃ¼leme overlay */
    .fullscreen-overlay { position:fixed; inset:0; background:#000; display:none; z-index:10000; align-items:center; justify-content:center; }
    .fullscreen-overlay.open { display:flex; }
    .fullscreen-overlay img { max-width:95vw; max-height:95vh; object-fit:contain; }
    .fullscreen-close { position:absolute; top:20px; right:20px; background:rgba(0,0,0,.6); color:#fff; border:1px solid #444; padding:10px 14px; border-radius:8px; cursor:pointer; font-size:.85rem; }
    .preview-overlay {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 12px 16px;
      background: linear-gradient(180deg, transparent, rgba(2,6,23,.85));
      font-size: .85rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .match-meta { font-size: .85rem; color: var(--text-muted); }
    .result-list { display: flex; flex-direction: column; gap: 12px; }
    .result-item {
      border-radius: 14px;
      background: rgba(15,23,42,.7);
      border: 1px solid rgba(148,163,184,.2);
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      cursor: pointer;
    }
    .result-item.active { border-color: rgba(59,130,246,.6); box-shadow: 0 0 0 1px rgba(59,130,246,.35); }
    .result-item .score { color: #facc15; font-weight: 600; }
    .result-item small { color: var(--text-muted); font-size: .8rem; }
    .json-dump { margin-top: 18px; background: rgba(2,6,23,.9); border-radius: 14px; border: 1px solid rgba(148,163,184,.2); }
    details { padding: 16px; }
    pre { margin: 12px 0 0; white-space: pre-wrap; word-break: break-word; color: #a5b4fc; }
    .empty-state { text-align: center; padding: 30px; color: var(--text-muted); }
    .empty-state.subtle { padding: 20px; border: 1px dashed rgba(148,163,184,.25); border-radius: 12px; }
    .chip { font-size: .75rem; padding: 6px 10px; border-radius: 999px; background: rgba(15,23,42,.65); border: 1px solid rgba(148,163,184,.25); }
    .archive-preview {
      margin-top: 20px;
      border-radius: 16px;
      background: rgba(12,18,34,.85);
      border: 1px solid rgba(148,163,184,.2);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .archive-preview-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .archive-preview-header h3 { margin: 0; font-size: .95rem; letter-spacing: .05em; text-transform: uppercase; color: var(--text-muted); }
    .archive-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 12px; }
    .archive-item {
      position: relative;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,.25);
      overflow: hidden;
      min-height: 96px;
      background: radial-gradient(circle at top, rgba(15,23,42,.7), rgba(15,23,42,.9));
      padding: 0;
      cursor: pointer;
    }
    .archive-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .archive-item-label {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 6px 10px;
      font-size: .75rem;
      background: linear-gradient(180deg, transparent, rgba(2,6,23,.85));
      color: #e2e8f0;
      text-align: center;
    }
    .archive-item.active { border-color: rgba(59,130,246,.7); box-shadow: 0 0 0 1px rgba(59,130,246,.35); }
    .archive-actions { display: flex; gap: 10px; }
    .archive-actions button { flex: 1; }
    .gallery-panel { }
    .gallery-header { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .gallery-header p { margin: 4px 0 0; color: var(--text-muted); font-size: .85rem; }
    .gallery-grid { margin-top: 16px; display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 14px; }
    .gallery-item { position: relative; border-radius: 16px; overflow: hidden; border: 1px solid rgba(148,163,184,.25); background: rgba(2,6,23,.75); min-height: 140px; cursor: pointer; }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .gallery-item .label {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 8px 10px;
      background: linear-gradient(180deg, transparent, rgba(2,6,23,.85));
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .gallery-item .label strong { font-size: .85rem; }
    .gallery-item .label span { font-size: .7rem; color: var(--text-muted); }
    .gallery-item:hover { border-color: rgba(59,130,246,.5); box-shadow: 0 10px 25px rgba(15,23,42,.5); }
    @@media (max-width: 1200px) {
      .grid { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    }
    .logo-dialog {
      position: fixed;
      inset: 0;
      background: rgba(2,6,23,.8);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 10;
    }
    .logo-dialog.open { display: flex; }
    .logo-card {
      width: min(520px, 100%);
      display: flex;
      flex-direction: column;
      gap: 16px;
      text-align: center;
    }
    .logo-card .drop-zone {
      border: 2px dashed rgba(59,130,246,.4);
      border-radius: 16px;
      padding: 24px;
      cursor: pointer;
      color: var(--text-muted);
      background: rgba(13,18,35,.7);
    }
    .logo-card input { display: none; }
    .logo-card img { max-width: 240px; height: auto; margin: 0 auto; }

    @@media (max-width: 768px) {
      body { padding: 16px; }
      .panel { padding: 16px; }
      .preview-window { min-height: 220px; }
      .archive-grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      button { width: 100%; }
      .archive-actions { flex-direction: column; }
    }
    @@media (max-width: 520px) {
      .camera-card input[type="file"] { padding: 18px; }
      .grid { grid-template-columns: 1fr; }
    }
    /* Aktif durum stilleri */
    .active-category { outline: 2px solid #fff; box-shadow: 0 0 0 3px rgba(255,255,255,.15); }
    .folder-item.active-folder { background:#0d47a1 !important; box-shadow: 0 0 0 2px rgba(255,255,255,.25); }
  </style>
</head>
<body>
<div class="shell">
  <div id="fullscreen-overlay" class="fullscreen-overlay">
    <button type="button" id="fullscreen-close" class="fullscreen-close">Ã‡Ä±k (Esc)</button>
    <img id="fullscreen-img" alt="Tam ekran" />
  </div>
  <div class="logo-dialog" id="logo-modal">
    <div class="panel logo-card">
      <div class="panel-title">
        <h2>Logo AyarÄ±</h2>
        <button type="button" class="ghost" id="logo-close">Kapat</button>
      </div>
      <img id="logo-preview" src="@logoPath" alt="Logo Ã¶nizleme" style="max-width:240px; height:auto; margin:0 auto;" />
      <label class="drop-zone" for="logo-input">
        <strong>Kurumsal logonuzu yÃ¼kleyin</strong>
        <p style="margin:6px 0 12px;">PNG Â· JPG Â· SVG desteklenir Â· 5MB sÄ±nÄ±r.</p>
        <input type="file" id="logo-input" accept="image/*" />
      </label>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <button type="button" class="ghost" id="logo-reset">VarsayÄ±lan logoya dÃ¶n</button>
        <button type="button" class="primary" id="logo-close-secondary">Kapat</button>
      </div>
    </div>
  </div>

  <main class="grid">
    <section class="panel" style="display:flex; flex-direction:column; gap:16px;">
      <!-- Logo Frame -->
      <div id="logo-frame" style="background:#2d3748; border:2px solid #4299e1; border-radius:12px; padding:8px; min-height:120px; display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative;" title="Logonuzu deÄŸiÅŸtirmek iÃ§in tÄ±klayÄ±n">
        <img id="side-logo" src="@logoPath" data-default="@logoPath" alt="Logo" style="max-width:90%; max-height:100px; object-fit:contain;" />
        <div style="position:absolute; top:4px; right:4px; background:rgba(0,0,0,0.6); padding:4px 8px; border-radius:4px; font-size:10px;">ğŸ–¼ï¸</div>
      </div>

      <!-- Kategori ButonlarÄ± -->
      <div style="display:flex; gap:8px;">
        <button class="primary" id="btn-desenler" style="flex:1; background:#ff9800; border:none; height:44px; font-size:14px; font-weight:bold;">ğŸ¨ Desenler</button>
        <button class="ghost" id="btn-varyantlar" style="flex:1; background:#424242; border:none; height:44px; font-size:14px; font-weight:bold; color:#fff;">ğŸ“ Varyantlar</button>
      </div>

      <!-- Yeni TasarÄ±mlar Badge -->
      <div style="background:#4caf50; padding:12px; border-radius:8px; text-align:center;">
        <div style="font-size:12px; font-weight:bold;">â­â­â­ Yeni TasarÄ±mlar â­â­â­</div>
        <div style="font-size:18px; font-weight:bold; color:#fff; margin-top:4px;">(6 desen)</div>
      </div>

      <!-- KlasÃ¶r Listesi -->
      <div id="folder-list" style="display:flex; flex-direction:column; gap:6px; max-height:400px; overflow-y:auto;">
        <button class="folder-item ghost" data-folder="Dar Viskon Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">Dar Viskon Desenler <span style="color:#ef5350; float:right;">(139 desen)</span></button>
        <button class="folder-item ghost" data-folder="EteÄŸi Sulu Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">EteÄŸi Sulu Desenler <span style="color:#ef5350; float:right;">(79 desen)</span></button>
        <button class="folder-item ghost" data-folder="GeniÅŸ Viskon Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">GeniÅŸ Viskon Desenler <span style="color:#ef5350; float:right;">(245 desen)</span></button>
        <button class="folder-item ghost" data-folder="Leopar Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">Leopar Desenler <span style="color:#ef5350; float:right;">(83 desen)</span></button>
        <button class="folder-item ghost" data-folder="SÃ¼et Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">SÃ¼et Desenler <span style="color:#ef5350; float:right;">(251 desen)</span></button>
        <button class="folder-item ghost" data-folder="Turlu Viskon Desenler" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">Turlu Viskon Desenler <span style="color:#ef5350; float:right;">(395 desen)</span></button>
        <button class="folder-item ghost" data-folder="ÅABLONU OLAN DESENLER" style="text-align:left; padding:10px; background:#1976d2; border:none; color:#fff; font-size:13px;">ÅABLONU OLAN DESENLER <span style="color:#ef5350; float:right;">(749 desen)</span></button>
      </div>

      <!-- Arama -->
      <input type="text" id="search-input" placeholder="ğŸ” Desen veya etiket ara..." style="width:100%; padding:10px; border-radius:8px; background:#1e293b; border:1px solid #475569; color:#fff;" />

      <!-- Alt Butonlar -->
      <button class="primary" id="pdf-btn" style="width:100%; background:#1e88e5; border:none; height:44px; font-size:14px; font-weight:bold;">ğŸ“„ PDF OluÅŸtur</button>
      <button class="primary" id="refresh-btn" style="width:100%; background:#4caf50; border:none; height:44px; font-size:14px; font-weight:bold;">ğŸ”„ Yenile</button>
      <button class="ghost" id="exit-btn" style="width:100%; background:#f44336; border:none; height:44px; font-size:14px; font-weight:bold; color:#fff;">âŒ Ã‡Ä±kÄ±ÅŸ</button>
    </section>

    <section class="stack">
      <section class="panel">
        <h2 id="main-title">ğŸ–¼ï¸ Ana Ã–nizleme</h2>
        <div class="preview-window" style="height:500px; margin-top:16px;">
          <img id="main-preview" alt="Ana Ã¶nizleme" />
          <div class="preview-overlay">
            <span>ğŸ“Š 0.71 MB Â· ğŸ“ 1200x848 Â· â­ 100%</span>
            <button class="ghost" style="position:absolute; bottom:12px; right:12px;">Tam Ekran (Ã‡ift TÄ±kla veya F)</button>
          </div>
        </div>
      </section>

      <!-- KlasÃ¶r / Kategori Ã‡oklu Ã–nizleme Gallery -->
      <section class="panel gallery-panel">
        <div class="gallery-header">
          <h2>ğŸ“‚ Ã‡oklu Ã–nizleme</h2>
          <p id="gallery-description" style="margin:0; font-size:.8rem; color:var(--text-muted)"></p>
        </div>
        <div id="gallery-grid" class="gallery-grid"></div>
      </section>

      <section class="panel">
        <div class="camera-card">
          <label for="file-input">Telefon KamerasÄ±</label>
          <input id="file-input" type="file" accept="image/*" capture="environment" />
          <div style="display:flex; gap:8px;">
            <button class="ghost" type="button" id="capture-btn">KamerayÄ± AÃ§</button>
            <button class="primary" type="button" id="analyze-btn" disabled>AramayÄ± BaÅŸlat</button>
          </div>
          <small style="color:var(--text-muted);">Desteklenen formatlar: JPG Â· PNG Â· BMP Â· 20MB sÄ±nÄ±r</small>
        </div>
      </section>
    </section>

    <section class="panel">
      <button class="primary" type="button" id="archive-search-btn" style="width:100%; height:50px; font-size:16px; margin-bottom:10px;">ğŸ” ArÅŸivden Ara</button>
      <button class="primary" type="button" id="search-by-image-btn" style="width:100%; height:46px; font-size:15px; margin-bottom:20px;">ğŸ“· Resimden Ara</button>
      <input id="search-file-input" type="file" accept="image/*" capture="environment" style="display:none;" />
      
      <h2>ğŸ·ï¸ Etiket YÃ¶netimi</h2>
      <div style="margin-top:16px;">
        <input type="text" id="new-tag-input" placeholder="ğŸ”– Yeni etiket ekle..." style="width:100%; margin-bottom:10px;" />
        <button class="primary" type="button" id="add-tag-btn" style="width:100%; margin-bottom:20px;">â• Ekle (Enter)</button>
        
        <h3 style="font-size:14px; margin-bottom:10px;">Mevcut Etiketler</h3>
        <div id="tag-list" style="display:flex; flex-direction:column; gap:8px;">
          <div class="empty-state subtle">HenÃ¼z etiket eklenmedi</div>
        </div>
      </div>
      
      <h3 style="font-size:14px; margin-top:24px; margin-bottom:10px;">ğŸ“Š Ä°statistikler</h3>
      <div style="background:rgba(31,106,165,0.1); padding:12px; border-radius:8px;">
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>KlasÃ¶r:</span><strong>26</strong>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>Desenler:</span><strong>1929</strong>
        </div>
        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
          <span>Varyantlar:</span><strong>1294</strong>
        </div>
        <div style="display:flex; justify-content:space-between;">
          <span>Etiketli:</span><strong style="color:#f44336;">0</strong>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
const state = {
  file: null,
  results: [],
  selected: null,
  gallery: [],
  currentCategory: null,
  tags: [],
  mainToken: null
};
// Element referanslarÄ±nÄ± lazy olarak al (DOM hazÄ±r olduÄŸunda)
const elements = {};
function getElements() {
  if (elements._initialized) return elements;
  Object.assign(elements, {
    input: document.getElementById('file-input'),
    analyze: document.getElementById('analyze-btn'),
    capturePreview: document.getElementById('capture-preview'),
    captureLabel: document.getElementById('capture-label'),
    captureMeta: document.getElementById('capture-meta'),
    matchPreview: document.getElementById('match-preview'),
    matchLabel: document.getElementById('match-label'),
    matchMeta: document.getElementById('match-meta'),
    matchScore: document.getElementById('match-score'),
    resultList: document.getElementById('result-list'),
    jsonOutput: document.getElementById('json-output'),
    archiveGrid: document.getElementById('archive-grid'),
    refreshArchive: document.getElementById('refresh-archive'),
    pythonStatus: document.getElementById('python-status'),
    sideLogo: document.getElementById('side-logo'),
    logoFrame: document.getElementById('logo-frame'),
    logoPreview: document.getElementById('logo-preview'),
    logoInput: document.getElementById('logo-input'),
    logoReset: document.getElementById('logo-reset'),
    galleryGrid: document.getElementById('gallery-grid'),
    refreshGallerySecondary: document.getElementById('refresh-gallery-secondary'),
    galleryDescription: document.getElementById('gallery-description'),
    logoModal: document.getElementById('logo-modal'),
    logoClose: document.getElementById('logo-close'),
    logoCloseSecondary: document.getElementById('logo-close-secondary'),
    mainPreview: document.getElementById('main-preview'),
    mainTitle: document.getElementById('main-title'),
    btnDesenler: document.getElementById('btn-desenler'),
    btnVaryantlar: document.getElementById('btn-varyantlar'),
    archiveSearchBtn: document.getElementById('archive-search-btn'),
    searchBtn: document.getElementById('search-by-image-btn'),
    searchFile: document.getElementById('search-file-input'),
    searchInput: document.getElementById('search-input'),
    pdfBtn: document.getElementById('pdf-btn'),
    refreshBtn: document.getElementById('refresh-btn'),
    exitBtn: document.getElementById('exit-btn'),
    tagInput: document.getElementById('new-tag-input'),
    addTagBtn: document.getElementById('add-tag-btn'),
    tagList: document.getElementById('tag-list'),
    fullscreenOverlay: document.getElementById('fullscreen-overlay'),
    fullscreenImg: document.getElementById('fullscreen-img'),
    fullscreenClose: document.getElementById('fullscreen-close'),
    _initialized: true
  });
  return elements;
}
getElements(); // Ä°lk Ã§aÄŸrÄ±
const defaultLogoSrc = elements.sideLogo?.dataset?.default || elements.sideLogo?.src;
const logoStorageKey = 'tasarim.customLogo';

const bytesToSize = bytes => {
  if (!bytes) return '0 KB';
  const sizes = ['B','KB','MB','GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(1024));
  return `${(bytes / Math.pow(1024, i)).toFixed(1)} ${sizes[i]}`;
};

const encodePath = path => btoa(unescape(encodeURIComponent(path)));

function toggleLogoModal(forceOpen) {
  if (!elements.logoModal) return;
  const shouldOpen = typeof forceOpen === 'boolean'
    ? forceOpen
    : !elements.logoModal.classList.contains('open');
  elements.logoModal.classList.toggle('open', shouldOpen);
}

async function pingPython() {
  if (!elements.pythonStatus) return;
  try {
    const resp = await fetch('/healthz', { cache: 'no-store' });
    const data = await resp.json();
    if (!resp.ok || data.status !== 'ok') {
      throw new Error(data.message || 'UlaÅŸÄ±lamÄ±yor');
    }
    elements.pythonStatus.textContent = `CLIP Servisi Â· ${data.archiveIndexed ?? 'aktif'}`;
    elements.pythonStatus.classList.remove('warn');
    elements.pythonStatus.classList.add('ok');
  } catch (err) {
    if (elements.pythonStatus) {
      elements.pythonStatus.textContent = 'CLIP Servisi Â· ulaÅŸÄ±lamÄ±yor';
      elements.pythonStatus.classList.remove('ok');
      elements.pythonStatus.classList.add('warn');
    }
    console.warn('Ping hatasÄ±:', err);
  }
}

initLogoFromStorage();
loadArchiveSamples();
// VarsayÄ±lan olarak ilk Ã¶nizlemeyi getir
// loadCategoryPreview artÄ±k kategori kullanmÄ±yor, doÄŸrudan folder bazlÄ±

elements.input.addEventListener('change', () => {
  const file = elements.input.files?.[0];
  state.file = file || null;
  if (!file) {
    if (elements.analyze) elements.analyze.disabled = true;
    elements.capturePreview?.removeAttribute?.('src');
    if (elements.captureLabel) elements.captureLabel.textContent = 'HazÄ±r';
    if (elements.captureMeta) elements.captureMeta.textContent = '0 KB';
    return;
  }
  if (elements.analyze) elements.analyze.disabled = false;
  if (elements.captureLabel) elements.captureLabel.textContent = file.name;
  if (elements.captureMeta) elements.captureMeta.textContent = `${bytesToSize(file.size)} Â· ${file.type || 'Bilinmiyor'}`;
  const url = URL.createObjectURL(file);
  if (elements.capturePreview) elements.capturePreview.src = url;
});

document.getElementById('capture-btn').addEventListener('click', () => elements.input.click());
elements.refreshArchive?.addEventListener('click', () => renderArchivePreview());
elements.refreshGallerySecondary?.addEventListener('click', () => loadArchiveSamples(true));
elements.logoInput?.addEventListener('change', () => {
  const file = elements.logoInput.files?.[0];
  if (!file) return;
  if (file.size > 5 * 1024 * 1024) {
    alert('Logo dosyasÄ± 5MB sÄ±nÄ±rÄ±nÄ± aÅŸÄ±yor.');
    return;
  }
  const reader = new FileReader();
  reader.onload = e => {
    const result = e.target?.result;
    if (typeof result === 'string') {
      setLogoSource(result, true);
    }
  };
  reader.readAsDataURL(file);
});
elements.logoReset?.addEventListener('click', () => setLogoSource(defaultLogoSrc || '', true, true));
elements.logoFrame?.addEventListener('click', () => toggleLogoModal(true));
elements.logoClose?.addEventListener('click', () => toggleLogoModal(false));
elements.logoCloseSecondary?.addEventListener('click', () => toggleLogoModal(false));
elements.logoModal?.addEventListener('click', evt => {
  if (evt.target === elements.logoModal) toggleLogoModal(false);
});
document.addEventListener('keydown', evt => {
  if (evt.key === 'Escape') toggleLogoModal(false);
});

// Sol panel kategori dÃ¼ÄŸmeleri - artÄ±k kullanÄ±lmÄ±yor (klasÃ¶r bazlÄ± sistem)
if (elements.btnDesenler) {
  elements.btnDesenler.addEventListener('click', () => {
    console.log('Desenler butonuna tÄ±klandÄ±!');
    elements.btnDesenler.classList.add('active-category');
    elements.btnVaryantlar?.classList.remove('active-category');
    state.currentCategory = null; // Kategori kullanmÄ±yoruz
    loadCategoryGallery(); // TÃ¼m klasÃ¶rlerden Ã¶nizleme
  });
}

if (elements.btnVaryantlar) {
  elements.btnVaryantlar.addEventListener('click', () => {
    console.log('Varyantlar butonuna tÄ±klandÄ± - devre dÄ±ÅŸÄ±');
    alert('Varyantlar Ã¶zelliÄŸi yakÄ±nda eklenecek');
  });
}

// Sol panel diÄŸer butonlar
elements.searchInput?.addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase();
  const folderItems = document.querySelectorAll('.folder-item');
  folderItems.forEach(item => {
    const text = item.textContent.toLowerCase();
    if (text.includes(query)) {
      item.style.display = '';
    } else {
      item.style.display = 'none';
    }
  });
});

elements.pdfBtn?.addEventListener('click', () => {
  generatePdf();
});

elements.refreshBtn?.addEventListener('click', () => {
  location.reload();
});

elements.exitBtn?.addEventListener('click', () => {
  if (confirm('Ã‡Ä±kmak istediÄŸinize emin misiniz?')) {
    window.close();
  }
});

// KlasÃ¶r listesi butonlarÄ±
const folderButtons = document.querySelectorAll('.folder-item');
console.log(`${folderButtons.length} adet klasÃ¶r butonu bulundu`);
folderButtons.forEach((btn, index) => {
  btn.addEventListener('click', async function() {
    const folderName = this.dataset.folder;
    console.log(`KlasÃ¶r ${index + 1} tÄ±klandÄ±: ${folderName}`);
    // GÃ¶rsel highlight
    folderButtons.forEach(b => b.classList.remove('active-folder'));
    this.classList.add('active-folder');
    try {
      // Tek ana Ã¶nizleme iÃ§in 1, gallery iÃ§in ayrÄ±ca Ã§aÄŸrÄ± yapÄ±lacak
      const params = new URLSearchParams({ take: '1', folder: folderName });
      // Kategori artÄ±k kullanÄ±lmÄ±yor
      const resp = await fetch(`/archive/samples?${params.toString()}`, { cache: 'no-store' });
      if (!resp.ok) throw new Error(await resp.text());
      const list = await resp.json();
      if (Array.isArray(list) && list.length) {
        setMainPreviewFromItem(list[0]);
        // Ã‡oklu Ã¶nizleme galerisi
        loadFolderGallery(folderName);
      } else {
        alert(`${folderName} klasÃ¶rÃ¼nde desen bulunamadÄ±.`);
      }
    } catch (err) {
      alert('KlasÃ¶r yÃ¼klenemedi: ' + err);
    }
  });
});

// SaÄŸ panel: ArÅŸivden Ara butonu
elements.archiveSearchBtn?.addEventListener('click', () => loadCategoryPreview(''));

// Resimden Ara (tek buton): dosya seÃ§tir ve yÃ¼kle
async function searchByFile(file) {
  if (!file) return;
  try {
    const fd = new FormData();
    fd.append('file', file);
    const resp = await fetch('/api/upload', { method: 'POST', body: fd });
    if (!resp.ok) throw new Error(await resp.text());
    const json = await resp.json();
    const results = Array.isArray(json) ? json : (json.all_results || json.results || []);
    state.results = results;
    if (results.length) {
      const best = results[0];
      if (best.path) {
        const token = encodePath(best.path);
        if (elements.mainPreview) {
          elements.mainPreview.src = `/archive/image?path=${encodeURIComponent(token)}&v=${Date.now()}`;
        }
        if (elements.mainTitle) {
          const fn = best.path.split('\\').pop() || 'EÅŸleÅŸme';
          elements.mainTitle.textContent = `ğŸ–¼ï¸ EÅŸleÅŸme Â· ${fn}`;
        }
      }
    }
    renderArchivePreview();
  } catch (err) {
    alert('Resimden arama baÅŸarÄ±sÄ±z: ' + err);
  }
}

elements.searchBtn?.addEventListener('click', () => elements.searchFile?.click());
elements.searchFile?.addEventListener('change', async () => {
  const f = elements.searchFile?.files?.[0];
  if (f) await searchByFile(f);
});

document.getElementById('analyze-btn').addEventListener('click', async () => {
  if (!state.file) {
    alert('Ã–nce telefon kameranÄ±zdan fotoÄŸraf Ã§ekin.');
    return;
  }
  const fd = new FormData();
  fd.append('file', state.file);
  elements.analyze.disabled = true;
  elements.analyze.textContent = 'AranÄ±yorâ€¦';
  try {
    const resp = await fetch('/api/upload', { method: 'POST', body: fd });
    if (!resp.ok) throw new Error(await resp.text());
    const json = await resp.json();
    state.results = json.all_results || [];
    elements.jsonOutput.textContent = JSON.stringify(json, null, 2);
    renderResults();
    if (state.results.length) selectResult(0); else clearMatch();
  } catch (err) {
    alert('Arama sÄ±rasÄ±nda hata oluÅŸtu:\n' + err);
  } finally {
    elements.analyze.disabled = false;
    elements.analyze.textContent = 'AramayÄ± BaÅŸlat';
  }
});

function clearMatch() {
  if (elements.matchLabel) elements.matchLabel.textContent = 'EÅŸleÅŸme bulunamadÄ±';
  if (elements.matchMeta) elements.matchMeta.textContent = '';
  if (elements.matchScore) elements.matchScore.textContent = '0%';
  elements.matchPreview?.removeAttribute?.('src');
  renderArchivePreview();
}

function renderResults() {
  if (!elements.resultList) {
    // SonuÃ§ listesi DOM'da yoksa sadece kÃ¼Ã§Ã¼k Ã¶nizlemeyi gÃ¼ncelle
    renderArchivePreview();
    return;
  }
  elements.resultList.innerHTML = '';
  if (!state.results.length) {
    elements.resultList.innerHTML = '<div class="empty-state">Arama tamamlandÄ± fakat eÅŸleÅŸme bulunamadÄ±.</div>';
    renderArchivePreview();
    return;
  }
  state.results.forEach((result, index) => {
    const item = document.createElement('div');
    item.className = 'result-item' + (state.selected === index ? ' active' : '');
    item.innerHTML = `
      <div style="display:flex; justify-content:space-between;">
        <strong>${result.path?.split('\\').pop() || 'Bilinmeyen'}</strong>
        <span class="score">${Math.round((result.score || 0)*100)}%</span>
      </div>
      <small>${result.path || ''}</small>
    `;
    item.addEventListener('click', () => selectResult(index));
    elements.resultList.appendChild(item);
  });
  renderArchivePreview();
}

function selectResult(index) {
  state.selected = index;
  renderResults();
  const result = state.results[index];
  if (!result) return;
  if (elements.matchLabel) elements.matchLabel.textContent = result.path?.split('\\').pop() || 'Desen';
  if (elements.matchMeta) elements.matchMeta.textContent = result.path || '';
  if (elements.matchScore) elements.matchScore.textContent = `${Math.round((result.score || 0)*100)}%`;
  if (result.path) {
    try {
      const token = encodePath(result.path);
      if (elements.matchPreview) elements.matchPreview.src = `/archive/image?path=${encodeURIComponent(token)}&v=${Date.now()}`;
    } catch {
      elements.matchPreview?.removeAttribute?.('src');
    }
  }
}

function setLogoSource(src, persist = false, clear = false) {
  if (!src && !clear && defaultLogoSrc) src = defaultLogoSrc;
  if (elements.sideLogo && src) elements.sideLogo.src = src;
  if (elements.logoPreview && src) elements.logoPreview.src = src;
  try {
    if (persist) {
      if (clear) localStorage.removeItem(logoStorageKey);
      else localStorage.setItem(logoStorageKey, src);
    }
  } catch (err) {
    console.warn('Logo kaydedilemedi', err);
  }
}

function initLogoFromStorage() {
  try {
    const stored = localStorage.getItem(logoStorageKey);
    if (stored) setLogoSource(stored);
  } catch {
    // localStorage devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸ olabilir
  }
}

async function loadArchiveSamples(showSpinner = false) {
  if (!elements.galleryGrid) return;
  if (showSpinner) {
    elements.galleryGrid.innerHTML = '<div class="empty-state subtle">ArÅŸiv yeniden taranÄ±yor...</div>';
  }

  try {
    const resp = await fetch('/archive/samples?take=12', { cache: 'no-store' });
    if (!resp.ok) throw new Error(await resp.text());
    const list = await resp.json();
    state.gallery = Array.isArray(list) ? list : [];
    renderGallery();
  } catch (err) {
    const message = err instanceof Error ? err.message : err;
    state.gallery = [];
    elements.galleryGrid.innerHTML = `<div class="empty-state subtle">ArÅŸiv okunamadÄ±:<br>${message}</div>`;
  }
}

async function loadCategoryPreview(category) {
  console.log(`loadCategoryPreview Ã§aÄŸrÄ±ldÄ±, category: "${category}"`);
  try {
    const params = new URLSearchParams({ take: '1' });
    if (category) params.append('category', category);
    const url = `/archive/samples?${params.toString()}`;
    console.log(`Fetch URL: ${url}`);
    const resp = await fetch(url, { cache: 'no-store' });
    console.log(`Fetch response status: ${resp.status}`);
    if (!resp.ok) throw new Error(await resp.text());
    const list = await resp.json();
    console.log('Fetch response data:', list);
    if (Array.isArray(list) && list.length) {
      console.log('setMainPreviewFromItem Ã§aÄŸrÄ±lÄ±yor, item:', list[0]);
      setMainPreviewFromItem(list[0]);
    } else {
      console.warn('ArÅŸivde kayÄ±t bulunamadÄ±');
      alert('ArÅŸivde gÃ¶sterilecek kayÄ±t bulunamadÄ±.');
    }
  } catch (err) {
    console.error('loadCategoryPreview hatasÄ±:', err);
    alert('ArÅŸiv yÃ¼klenemedi: ' + err);
  }
}

async function loadCategoryGallery(category) {
  try {
    const params = new URLSearchParams({ take: '24' });
    // Kategori artÄ±k kullanÄ±lmÄ±yor, tÃ¼m klasÃ¶rlerden yÃ¼kle
    const resp = await fetch(`/archive/samples?${params.toString()}`, { cache: 'no-store' });
    if (!resp.ok) throw new Error(await resp.text());
    const list = await resp.json();
    state.gallery = Array.isArray(list) ? list : [];
    renderGallery();
    if (elements.galleryDescription) elements.galleryDescription.textContent = `TÃ¼m Desenler Â· ${state.gallery.length} adet Ã¶nizleme`;
  } catch (err) {
    if (elements.galleryDescription) elements.galleryDescription.textContent = 'Galeri yÃ¼klenemedi';
  }
}

async function loadFolderGallery(folder) {
  try {
    const params = new URLSearchParams({ take: '24', folder });
    // Kategori kullanÄ±lmÄ±yor
    const resp = await fetch(`/archive/samples?${params.toString()}`, { cache: 'no-store' });
    if (!resp.ok) throw new Error(await resp.text());
    const list = await resp.json();
    state.gallery = Array.isArray(list) ? list : [];
    renderGallery();
    if (elements.galleryDescription) elements.galleryDescription.textContent = `${folder} Â· ${state.gallery.length} adet Ã¶nizleme`;
  } catch (err) {
    if (elements.galleryDescription) elements.galleryDescription.textContent = 'KlasÃ¶r galerisi yÃ¼klenemedi';
  }
}

function setMainPreviewFromItem(item) {
  console.log('setMainPreviewFromItem Ã§aÄŸrÄ±ldÄ±, item:', item);
  if (!item) {
    console.warn('Item boÅŸ!');
    return;
  }
  try {
    if (elements.mainPreview && item.token) {
      const imgUrl = `/archive/image?path=${encodeURIComponent(item.token)}&v=${Date.now()}`;
      console.log('GÃ¶rsel URL:', imgUrl);
      console.log('mainPreview element:', elements.mainPreview);
      elements.mainPreview.src = imgUrl;
      elements.mainPreview.onerror = () => console.error('Ana Ã¶nizleme yÃ¼klenemedi:', elements.mainPreview.src);
      elements.mainPreview.onload = () => console.log('Ana Ã¶nizleme yÃ¼klendi');
      state.mainToken = item.token || null;
    } else {
      console.warn('mainPreview veya token eksik:', { 
        hasMainPreview: !!elements.mainPreview, 
        hasToken: !!item.token,
        token: item.token 
      });
    }
    if (elements.mainTitle) {
      const title = `ğŸ–¼ï¸ ${item.fileName || 'Ã–nizleme'}`;
      console.log('BaÅŸlÄ±k gÃ¼ncelleniyor:', title);
      elements.mainTitle.textContent = title;
    } else {
      console.warn('mainTitle element bulunamadÄ±');
    }
  } catch (err) {
    console.error('setMainPreviewFromItem hatasÄ±:', err);
  }
}

// Tam ekran iÅŸlevleri
function openFullscreen(){
  if (!elements.mainPreview?.src) return;
  if (elements.fullscreenImg) elements.fullscreenImg.src = elements.mainPreview.src;
  elements.fullscreenOverlay?.classList.add('open');
}
function closeFullscreen(){
  elements.fullscreenOverlay?.classList.remove('open');
  if (elements.fullscreenImg) elements.fullscreenImg.removeAttribute('src');
}
elements.fullscreenClose?.addEventListener('click', closeFullscreen);
elements.mainPreview?.addEventListener('dblclick', openFullscreen);
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeFullscreen();
  if (e.key.toLowerCase() === 'f') {
    if (elements.fullscreenOverlay?.classList.contains('open')) closeFullscreen(); else openFullscreen();
  }
  if (e.key === 'ArrowRight') navigateFullscreen(1);
  if (e.key === 'ArrowLeft') navigateFullscreen(-1);
});
function navigateFullscreen(dir){
  if (!Array.isArray(state.gallery) || !state.gallery.length) return;
  const idxCurrent = state.gallery.findIndex(x => x.token === state.mainToken);
  if (idxCurrent === -1) return;
  let next = (idxCurrent + dir + state.gallery.length) % state.gallery.length;
  const item = state.gallery[next];
  setMainPreviewFromItem(item);
  if (elements.fullscreenOverlay?.classList.contains('open') && elements.fullscreenImg) {
    elements.fullscreenImg.src = `/archive/image?path=${encodeURIComponent(item.token)}&v=${Date.now()}`;
  }
}
elements.fullscreenOverlay?.addEventListener('click', e => { if (e.target === elements.fullscreenOverlay) closeFullscreen(); });

function renderGallery() {
  if (!elements.galleryGrid) return;
  elements.galleryGrid.innerHTML = '';
  if (!state.gallery.length) {
    elements.galleryGrid.innerHTML = '<div class="empty-state subtle">ArÅŸivde gÃ¶rÃ¼ntÃ¼lenecek desen bulunamadÄ±.</div>';
    return;
  }

  state.gallery.forEach(item => {
    const tile = document.createElement('button');
    tile.type = 'button';
    tile.className = 'gallery-item';
    if (item.token) {
      const img = document.createElement('img');
      img.loading = 'lazy';
      img.alt = item.fileName || 'Desen';
      img.src = `/archive/image?path=${encodeURIComponent(item.token)}&v=${Date.now()}`;
      tile.appendChild(img);
    }
    const label = document.createElement('div');
    label.className = 'label';
    const title = document.createElement('strong');
    title.textContent = item.fileName || 'Desen';
    const folderLine = document.createElement('span');
    folderLine.textContent = item.folder || 'KlasÃ¶r bilinmiyor';
    label.appendChild(title);
    label.appendChild(folderLine);
    tile.appendChild(label);
    tile.addEventListener('click', () => focusGalleryItem(item));
    elements.galleryGrid.appendChild(tile);
  });
}

// Etiket ekleme iÅŸlevi
function renderTags() {
  if (!elements.tagList) return;
  if (!state.tags.length) {
    elements.tagList.innerHTML = '<div class="empty-state subtle">HenÃ¼z etiket eklenmedi</div>';
    return;
  }
  elements.tagList.innerHTML = '';
  state.tags.forEach((tag, i) => {
    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.alignItems = 'center';
    row.style.gap = '8px';
    const pill = document.createElement('span');
    pill.className = 'pill';
    pill.textContent = tag;
    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.className = 'ghost';
    removeBtn.style.padding = '4px 8px';
    removeBtn.style.fontSize = '.7rem';
    removeBtn.textContent = 'Sil';
    removeBtn.addEventListener('click', () => {
      state.tags.splice(i,1);
      renderTags();
    });
    row.appendChild(pill);
    row.appendChild(removeBtn);
    elements.tagList.appendChild(row);
  });
}

function addTag() {
  const val = elements.tagInput?.value?.trim();
  if (!val) return;
  if (state.tags.includes(val)) {
    alert('Bu etiket zaten eklenmiÅŸ');
    return;
  }
  state.tags.push(val);
  persistTags();
  elements.tagInput.value='';
  renderTags();
}

elements.addTagBtn?.addEventListener('click', addTag);
elements.tagInput?.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addTag(); }});
renderTags();

// Tag persistence
const tagStorageKey = 'tasarim.tags';
function persistTags(){
  try { localStorage.setItem(tagStorageKey, JSON.stringify(state.tags)); } catch {}
}
function loadTags(){
  try {
    const raw = localStorage.getItem(tagStorageKey);
    if (raw){
      const arr = JSON.parse(raw);
      if (Array.isArray(arr)) { state.tags = arr.filter(x => typeof x === 'string').slice(0,200); }
    }
  } catch {}
  renderTags();
}
loadTags();

// PDF oluÅŸturma
async function generatePdf(){
  try {
    const body = {
      title: 'Desen Ã‡alÄ±ÅŸmasÄ±',
      tags: state.tags,
      selectedFileName: elements.mainTitle?.textContent?.replace('ğŸ–¼ï¸ ','') || null,
      category: state.currentCategory,
      folder: document.querySelector('.folder-item.active-folder')?.dataset.folder || null,
      selectedToken: state.mainToken
    };
    const resp = await fetch('/api/pdf', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body) });
    if (!resp.ok) throw new Error(await resp.text());
    const blob = await resp.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'desen_raporu.pdf';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 5000);
  } catch(err){
    alert('PDF oluÅŸturulamadÄ±: '+ err);
  }
}

function focusGalleryItem(item) {
  if (!item) return;
  elements.matchLabel.textContent = item.fileName || 'ArÅŸiv Deseni';
  elements.matchMeta.textContent = item.folder ? item.folder : (item.path || '');
  elements.matchScore.textContent = 'ArÅŸiv';
  if (item.token) {
    elements.matchPreview.src = `/archive/image?path=${encodeURIComponent(item.token)}&v=${Date.now()}`;
  }
}

function renderArchivePreview() {
  if (!elements.archiveGrid) return;
  elements.archiveGrid.innerHTML = '';
  const subset = state.results.slice(0, 6);
  if (!subset.length) {
    elements.archiveGrid.innerHTML = '<div class="empty-state subtle">Arama sonrasÄ±nda ilk altÄ± eÅŸleÅŸme burada gÃ¶rÃ¼necek.</div>';
    return;
  }
  subset.forEach((result, index) => {
    const tile = document.createElement('button');
    tile.type = 'button';
    tile.className = 'archive-item' + (state.selected === index ? ' active' : '');
    if (result.path) {
      try {
        const img = document.createElement('img');
        img.loading = 'lazy';
        img.alt = 'ArÅŸiv desen Ã¶nizlemesi';
        img.src = `/archive/image?path=${encodeURIComponent(encodePath(result.path))}&v=${Date.now() + index}`;
        tile.appendChild(img);
      } catch {
        // ignore broken preview
      }
    }
    const label = document.createElement('div');
    label.className = 'archive-item-label';
    label.textContent = result.path?.split('\\').pop() || `Desen ${index + 1}`;
    tile.appendChild(label);
    tile.addEventListener('click', () => selectResult(index));
    elements.archiveGrid.appendChild(tile);
  });
}

renderArchivePreview();
</script>
</body>
</html>
